script:
  - type: send
    at_ms: 100
    payload:
      type: event
      event: state_changed
      entity_id: binary_sensor.doorbell
      new_state: {state: "on"}
  - type: expect
    timeout_ms: 1000
    match:
      type: call_service
      domain: notify
      service: mobile_app
      service_data: {message: "Someone is at the door!", data: {image: "camera.front_door"}}
  - type: expect
    timeout_ms: 1000
    match:
      type: call_service
      domain: media_player
      service: play_media
      service_data: {media_content_id: "ding_dong.mp3"}
